# Lemon framework ä½¿ç”¨æŒ‡å—

##  è§„èŒƒ

+   é™¤æ¥å£å¤–ï¼Œå…¶ä»–å„ä¸šåŠ¡æ¨¡å—åŸåˆ™ä¸Šä¸å…è®¸ç›´æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹jaråŒ…ï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œéœ€è¦å°è£…åå†ä½¿ç”¨
+   æ—¥æœŸï¼Œæ—¶é—´ä½¿ç”¨javaæä¾›çš„LocalDateå’ŒLocalDateTimeï¼Œå¹³å°Spring mvc ã€ mybatis å·²æä¾›æ”¯æŒ
+   ä»»ä½•æš´éœ²çš„æ¥å£è¿”å›ç±»å‹å¿…é¡»æ˜¯[GenericRspDTO](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/data/GenericRspDTO.java)ç±»å‹å¯¹è±¡ï¼Œè¾“å…¥å‚æ•°ä¸­å¿…é¡»ğŸˆ¶ï¸ä¸€ä¸ªå‚æ•°æ˜¯[GenericDTO]()ç±»å‹æˆ–å…¶å­ç±»å‹ï¼Œå»ºè®®å°±ä¸€ä¸ªGenericDTOç±»å‹å‚æ•°
+   æš´éœ²æ¥å£ä»…ä»…åªéœ€è¦è¿”å›æ¶ˆæ¯ç æ—¶ï¼Œè¿”å›å¯¹è±¡åº”å®šä¹‰ä¸º ```GenericRspDTO<NoBody>```
+   åœ¨application.yml å¢åŠ ä¸šåŠ¡å‚æ•°çš„æ—¶å€™ï¼Œå¿…é¡»ä»¥æ¨¡å—åå¼€å¤´. å¦‚ç”¨æˆ·æ¨¡å—ï¼š
+   redisç¼“å­˜æ‰€æœ‰çš„KEYå¿…é¡»åŠ å‰ç¼€ï¼Œå¦‚ idç”Ÿæˆæ˜¯IDGENï¼Œç¼“å­˜æ˜¯CACHEï¼Œç´¯è®¡æ˜¯CUMULATIVE.åŸåˆ™ä¸Šåº”ç”¨ä¸å…è®¸ç›´æ¥ç”¨RedisTempleteæ“ä½œredis

```yaml
usr :
    test : testparam
    
```
+   Controller ç±»å¿…é¡»ç»§æ‰¿åŸºç±» [BaseController](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/service/BaseService.java)
+   Service ç±»å¿…é¡»ç»§æ‰¿åŸºç±» [BaseService](http://120.76.22.56/microservices-platform/framework/tree/master/lemon-framework/src/main/java/com/hisun/lemon/framework/service)
+   Redis ç¼“å­˜çš„ä½¿ç”¨ï¼Œä»»ä½•KEYå¿…é¡»å¸¦å‰ç¼€ï¼Œå¦‚IDç”Ÿæˆå‰ç¼€æ˜¯IDGENï¼Œç¼“å­˜çš„å‰ç¼€æ˜¯CACHEï¼Œç´¯è®¡çš„å‰ç¼€æ˜¯CUMULATIVEï¼›åŸåˆ™ä¸Šä¸å…è®¸ä½¿ç”¨æ¡†æ¶æä¾›ä¹‹å¤–çš„æ–¹æ³•è®¿é—®redis
+   æ‰€æœ‰çš„Feign interface å¼€å‘åªå¼•å…¥ä¸‹é¢çš„åŒ…,é˜²æ­¢ç¬¬ä¸‰æ–¹å¼•å…¥æ¥å£æ—¶åŒ…å†²çª

```gradle
dependencies {
    compile("com.hisun:lemon-interface")
}
```



---------------------------------------

##  å»ºè®®
+   æš´éœ²æ¥å£è¾“å…¥è¾“å‡ºå‚æ•°ç”¨[GenericDTO](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/data/GenericDTO.java) çš„body å±æ€§ä¼ é€’
+   ä¼ è¾“å¯¹è±¡å‘½åä¸ºDTOï¼ŒæŒä¹…åŒ–å¯¹è±¡DOï¼Œ ä¸šåŠ¡å¯¹è±¡BO
+   å…ˆè·å–åˆ†å¸ƒå¼é”åå†è°ƒç”¨Serviceå±‚æœåŠ¡ï¼Œé¿å…å› ç­‰å¾…åˆ†å¸ƒå¼é”è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“è¿æ¥èµ„æºï¼›è§£å†³æ–¹æ³•è§åˆ†å¸ƒå¼é”

---------------------------------------

##  å·¥å…·ç±»
+   æ—¥æœŸã€æ—¶é—´å·¥å…·ç±»
    è§[com.hisun.lemon.common.utils.DateTimeUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/DateTimeUtils.java)

+   Bean ç›¸å…³ã€å¦‚å¯¹è±¡å±æ€§æ‹·è´
    è§[com.hisun.lemon.common.utils.BeanUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/BeanUtils.java)

+   åˆ¤æ–­ç±»ï¼Œå¦‚äº¤æ˜“è°ƒç”¨æ˜¯å¦æˆåŠŸçš„æ¶ˆæ¯ç åˆ¤æ–­ï¼Œnullã€ç©ºåˆ¤æ–­ç­‰ã€‚
    è§[com.hisun.lemon.common.utils.JudgeUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/JudgeUtils.java)

+   validate 
    è§[com.hisun.lemon.common.utils.Validate](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/Validate.java)

+   å­—ç¬¦ä¸²æ“ä½œ
    è§[com.hisun.lemon.common.utils.StringUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/StringUtils.java)

+   Numberæ“ä½œ
    è§[com.hisun.lemon.common.utils.NumberUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/NumberUtils.java)

+   èµ„æºç±»
    è§[com.hisun.lemon.common.utils.ResourceUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/ResourceUtils.java)

+   éšæœºæ•°ã€éšæœºå­—ç¬¦ä¸²ã€å›ºå®šé•¿åº¦éšæœºæ•°ã€å›ºå®šé•¿åº¦éšæœºå­—ç¬¦ä¸²
    è§[com.hisun.lemon.common.utils.RandomUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/RandomUtils.java)

+   åå°„ç›¸å…³
    è§[com.hisun.lemon.common.utils.ReflectionUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/ReflectionUtils.java)

+   æ³¨è§£ç›¸å…³
    è§[com.hisun.lemon.common.utils.AnnotationUtils](http://120.76.22.56/microservices-platform/framework/tree/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/AnnotationUtils.java)

+   IDã€åºåˆ—å·ç”Ÿæˆ
    è§[com.hisun.lemon.framework.utils.IdGenUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/utils/IdGenUtils.java)

+   æµæ°´å·ã€æ¶ˆæ¯å·ã€ç™»å½•ç”¨æˆ·å·ã€é…ç½®å‚æ•°ã€è®°è´¦æ—¥æœŸ ç­‰å¹³å°ç›¸å…³æ•°æ®
    è§[com.hisun.lemon.framework.utils.LemonUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/utils/LemonUtils.java)

+   åˆ†é¡µ
    è§[com.hisun.lemon.framework.utils.PageUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/utils/PageUtils.java)

+   SHA-1/MD5æ¶ˆæ¯æ‘˜è¦çš„å·¥å…·ç±»
    è§[com.hisun.lemon.common.security.Digests](http://120.76.22.56/microservices-platform/framework/tree/master/lemon-common/src/main/java/com/hisun/lemon/common/security/Digests.java)

+   HMAC-SHA1æ¶ˆæ¯ç­¾å åŠ DES/AESå¯¹ç§°åŠ å¯†çš„å·¥å…·ç±»
    è§[com.hisun.lemon.common.security.Cryptos](http://120.76.22.56/microservices-platform/framework/tree/master/lemon-common/src/main/java/com/hisun/lemon/common/security/Cryptos.java)

+   ç¼–ç è§£ç å·¥å…·ç±»
    è§[com.hisun.lemon.common.utils.Encodes](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-common/src/main/java/com/hisun/lemon/common/utils/Encodes.java)

---------------------------------------

##  æ—¥å¿—

+   slf4j + logback
+   é…ç½®æ–‡ä»¶    src/main/resource/config/logback-spring.xml
+   ç”Ÿäº§è®¾ç½®æ—¥å¿—çº§åˆ«INFOï¼Œå»ºè®®è°ƒè¯•éƒ½ç»Ÿä¸€è®¾ç½®ä¸ºDEBUG æˆ–ä»¥ä¸‹çº§åˆ«
+   æ—¥å¿—ä½¿ç”¨æ–¹å¼

```java
    public class UserController {
        private static final Logger logger = LoggerFactory.getLogger(UserController.class);
        
        public GenericDTO<NoBody> testException(GenericDTO<NoBody> object) {
            LemonException.throwBusinessException("PRD00001");
            if(logger.isErrorEnabled()) {
                logger.error("throw a exception, msg cd is {}.", "PRD00001");
            }
            return null;
        }
    }

```
    


---------------------------------------

##  å¼‚å¸¸

+   å¹³å°å¯¹å¼‚å¸¸åšç»Ÿä¸€å¤„ç†
+   ä¸šåŠ¡å¼‚å¸¸å°±æŠ›å‡ºcom.hisun.lemon.common.exception.LemonException, æŠ›å‡ºæ–¹å¼

```java
    public GenericDTO<NoBody> testException(GenericDTO<NoBody> object) {
        LemonException.throwBusinessException("PRD00001");
        return null;
    }

```
+   é”™è¯¯ç å»ºè®®ç”¨enum

+   å¹³å°é”™è¯¯ç 

>
>   **SYS00001** å¹³å°çº§å¼‚å¸¸
>
>   **SYS00002** è®¿é—®æ•°æ®åº“å¼‚å¸¸
>
>   **SYS00404** 404å¼‚å¸¸
>
>   **SYS00401** 401å¼‚å¸¸
>
>   **SYS00004** çº¿ç¨‹æ± æ»¡æ‹’ç»
>
>   **SYS00005** ä»»åŠ¡è°ƒåº¦å¼‚å¸¸
>
>   **SYS00004** æœåŠ¡ç«¯404å¼‚å¸¸ï¼Œå¦‚è¯·æ±‚èµ„æºä¸å­˜åœ¨
>
>   **SYS10001** bean validation å¼‚å¸¸
>
>   **SYS20000** feign client å¼‚å¸¸
>
>   **SYS20001** feign client UnknownHostException
>
>   **SYS99999** ä¸šåŠ¡ä»£ç æ²¡æœ‰è®¾ç½®msgCd
>

---------------------------------------

##  ID Generator

+   æ•°æ®æŒä¹…åŒ–å¯¹è±¡IDè‡ªåŠ¨ç”Ÿæˆ

```java
public class UserDO extends BaseDO{
    @AutoIdGen(key="USER_ID", prefix="US")
    private String userId;
    private String name;
    private String sex;
    //.......
}
```

+   IDã€åºåˆ—å·ç”Ÿæˆ
    è§[com.hisun.lemon.framework.utils.IdGenUtils](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-framework/src/main/java/com/hisun/lemon/framework/utils/IdGenUtils.java)
 
+   é…ç½®

```ymal
lemon :
  idgen :
    #æ¯æ¬¡ä»reidsç”³è¯·Idçš„æ•°é‡
    delta : 
      default : 500
      MSGID_ : 1000
      REQUESTID_ : 1000
    #åœ¨redisé‡ŒId key çš„å‰ç¼€ï¼Œprefix+"."+ applicationName,ç”³è¯·ID keyä½œä¸ºhash key.
    prefix : IDGEN
    #ID sequence æœ€å¤§å€¼ï¼Œé»˜è®¤å€¼æ— ç©·å¤§ï¼Œé…ç½®æ–¹å¼æ˜¯åœ¨max-value ä¸‹é…ç½®key åŠé•¿åº¦ 
    max-value :
      #msgId key
      MSGID_ : 999999999
      REQUESTID_ : 999999999
      USER_ID : 999999  
    autogen :
      #DOç›®å½•
      DOPackage : com.hisun.lemon.*.entity
```

---------------------------------------

##  åŠ¨æ€æ•°æ®æº

+   è§é…ç½®  application.yml

```yaml
lemon :
  #dynamic datasource
  dynamicDataSource : 
    enabled : true
    #ç”Ÿæ•ˆæ•°æ®æº
    dataSources : lemon,primary
    #é»˜è®¤æ•°æ®æº
    defaultDataSource : primary
  
#druid æ•°æ®æºé…ç½®   
dataSource :
  lemon :
    type : com.alibaba.druid.pool.DruidDataSource
    driverClassName : com.mysql.cj.jdbc.Driver
    url : jdbc:mysql://119.23.126.119:3306/lemon?useUnicode=true&characterEncoding=utf-8&serverTimezone=GMT%2B8
    username : lemon
    password : lemon@123
  primary :
    type : com.alibaba.druid.pool.DruidDataSource
    driverClassName : com.mysql.cj.jdbc.Driver
    url : jdbc:mysql://localhost:3306/seatelpay?useUnicode=true&characterEncoding=utf-8&serverTimezone=GMT%2B8
    username : seatelpay
    password : seatelpay

```

+   åˆ‡æ¢åˆ°éé»˜è®¤æ•°æ®æº, æ³¨è§£@com.hisun.lemon.framework.datasource.TargetDataSource

```java
    //åˆ‡æ¢åˆ°lemonæ•°æ®æº
    @Transactional(readOnly=true)
    @TargetDataSource("lemon")
    public MsgInfoDO getMsgInfo(String msgCd, String language) {
        if(JudgeUtils.isBlank(msgCd)) {
            return null;
        }
        if(JudgeUtils.isBlank(language)) {
            if(JudgeUtils.isBlank(this.defaultLanguage)){
                this.defaultLanguage = this.defaultLocale.split("_")[0];
            }
            language = this.defaultLanguage;
        }
        return this.msgInfoDao.getMsgInfo(msgCd, language);
    }
```


---------------------------------------

##  åˆ†é¡µ
```java
List<UserDO> userDOs = PageUtils.pageQuery(userQueryDTO.getPageNum(), userQueryDTO.getPageSize(), () -> {
            return this.userService.findUser(queryUserDO);
            });
            
æˆ–
            
List<UserDO> userDOs = PageUtils.pageQuery(userQueryDTO.getPageNum(), userQueryDTO.getPageSize(), false, () -> {
            return this.userService.findUser(queryUserDO);
            });
```

---------------------------------------

## äº‹åŠ¡
+   Spring æ³¨è§£äº‹åŠ¡
+   äº‹åŠ¡å¿…é¡»åœ¨Serviceå±‚æ§åˆ¶

---------------------------------------

## ç¼“å­˜

+   æœ‰redisç¼“å­˜å’Œehcache3.X(ä¸»è¦ç”¨åšå †å†…ç¼“å­˜)
+   ehcache3.0 å®é™…æ˜¯JCache çš„providerï¼Œå®ç°äº†JSR107

### Redis ç¼“å­˜
+   redis ä¸»è¦ç”¨ä½œåˆ†å¸ƒå¼ç¼“å­˜
+   ç”¨æ³¨è§£@RedisCacheable æ–¹æ³•å³å¯ä»¥å®ç°redisç¼“å­˜æ“ä½œï¼ŒåŸç†æ˜¯ï¼šå…ˆæŸ¥æ‰¾ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰æ•°æ®æ‰§è¡Œæ–¹æ³•å¾—åˆ°æ•°æ®ï¼Œè¿”å›å¾—åˆ°çš„æ•°æ®å¹¶å°†æ•°æ®å­˜å…¥ç¼“å­˜
+   æ³¨è§£@RedisCacheable çš„cacheName å‰ç¼€å¿…é¡»ä¸º ${lemon.cache.cacheName.prefix}
+   æ”¯æŒ@Cacheableã€@CachePutã€@CacheEvictï¼›ä½†éœ€è¦å°†cacheResolver æŒ‡å®šä¸º "redisCacheResolver"
+   é»˜è®¤çš„keyGenerator æ˜¯ "CACHE." + simple class name + method name + argsï¼›å¯ä»¥æŒ‰@Cacheable çš„key å±æ€§æŒ‡å®škeyï¼Œä½†key å¿…é¡»å¸¦å‰ç¼€ â€œCACHE.â€ï¼Œ æ”¯æŒELè¡¨è¾¾å¼
+   åŸåˆ™ä¸Šä¸å…è®¸ç”¨RedisTemplate ç›´æ¥æ“ä½œredis
+   å¯ä»¥æ ¹æ®ç¼“å­˜åè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸è®¾ç½®ä½¿ç”¨é»˜è®¤è¿‡æœŸæ—¶é—´ï¼šspring.redis.default-expiration

```yaml

lemon :
  cache :
    cacheName :
      prefix : CACHENAME.${spring.application.name}
    redis :
      expires :
        #redis cache expire time; cacheName : expireTime/s; 0 - never expire
        ${lemon.cache.cacheName.prefix}.user : 140 
        
```

```java

    @RedisCacheable(cacheNames="${lemon.cache.cacheName.prefix}.user")
    @Transactional(readOnly=true)
    @Override
    public UserDO findUser(String userId) {
        return this.userDao.findByUserId(userId);
    }
    
```

### Ehcache3 ç¼“å­˜ï¼Œ JCache ç¼“å­˜ï¼Œ ehcache3 ä½œä¸ºJCache çš„providerï¼ŒJSR107å®ç°

+   Ehcache3 ä¸»è¦ç”¨ä½œå †å†…ç¼“å­˜ï¼Œå¦‚æ¶ˆæ¯ç ä¿¡æ¯ç­‰
+   ä½¿ç”¨@JCacheCacheable æ³¨è§£æ–¹æ³•ï¼Œå³å¯ä»¥ä½¿ç”¨ ehcahceç¼“å­˜ï¼ŒåŸç†åŒredis
+   ehcache çš„é…ç½®è§config/ehcache3.xml, æ–°å¢ç¼“å­˜å¿…é¡»é…ç½®
+   cacheName å¯ä»¥ä¸æŒ‡å®šå‰ç¼€
+   keyç”Ÿæˆç­–ç•¥åŒredis

```java

    @JCacheCacheable("lemonMsgInfo")
    @Transactional(readOnly=true)
    @TargetDataSource("lemon")
    public MsgInfoDO getMsgInfo(String msgCd, String language) {
        if(JudgeUtils.isBlank(msgCd)) {
            return null;
        }
        if(JudgeUtils.isBlank(language)) {
            if(JudgeUtils.isBlank(this.defaultLanguage)){
                this.defaultLanguage = this.defaultLocale.split("_")[0];
            }
            language = this.defaultLanguage;
        }
        return this.msgInfoDao.getMsgInfo(msgCd, language);
    }
    

```

```xml

    <cache alias="lemonMsgInfo">
	    <expiry>
	      <ttl unit="minutes">5</ttl>
	    </expiry>
	    <heap unit="entries">10000</heap>
	    <heap-store-settings>
	       <max-object-size unit="kB">10</max-object-size>
	    </heap-store-settings>
    </cache>

```

---------------------------------------

##  åˆ†å¸ƒå¼é”

+   ä½¿ç”¨æ³¨è§£@Lockedå®ç°åˆ†å¸ƒå¼é”
    
```java

    @Locked(lockName = "testLock", leaseTime=40, waitTime=10)
    @Scheduled(fixedRate=10000)
    public void testLock() {
        String str = "testLock1234567890..";
        for(char c : str.toCharArray()) {
            System.out.print(c);
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
            }
        }
        System.out.println("");
    }
    
```
+   åˆ†å¸ƒå¼é”ä¸è¦ç”¨åœ¨Serviceå±‚ï¼Œå› ä¸ºè¿™æ ·ä¼šå…ˆè·å–æ•°æ®åº“è¿æ¥ï¼Œå†æ¥ç­‰å¾…åº”ç”¨é”ï¼›å¯ä»¥ç”¨ä¸€ä¸ªéServiceå±‚(æˆ–è€…å«XXæœåŠ¡å±‚)æ–¹æ³•å¸¦èµ·Serviceå±‚æ–¹æ³•ï¼ŒXXæœåŠ¡å±‚æ³¨è§£@Lock,XXæœåŠ¡å±‚ä¸å«äº‹åŠ¡
+   @Locked æ³¨è§£è¿˜æœ‰ä¸€äº›å±æ€§ï¼Œè§ä»£ç 
+   å¦‚æœä¸ç”¨æ³¨è§£ï¼Œå¯ä»¥å†™javaä»£ç ä½¿ç”¨åˆ†å¸ƒå¼é”,å¯ä»¥è‡ªå·±æ§åˆ¶å¼‚å¸¸ï¼›å¦‚æœéå¿…é¡»ï¼Œè¿˜æ˜¯ä½¿ç”¨æ³¨è§£
+   å¦‚æœæ˜¯Scheduleç­‰åå°è°ƒèµ·çš„æœåŠ¡ï¼Œå»ºè®®å¿½ç•¥è°ƒæ‰€æœ‰å¼‚å¸¸ï¼Œä¸šåŠ¡æ–¹æ³•é‡Œå¼‚å¸¸ä¸è¦å¾€å¤–æŠ›ï¼ŒæŠ›å‡ºåˆ°çº¿ç¨‹æ± çš„çº¿ç¨‹ä¹Ÿæ²¡æ³•å¤„ç†ã€‚

```java

    @Autowired
    private DistributedLocker distributedLocker;

    @Around("@annotation(locked)")
    public void lock(ProceedingJoinPoint pjp, Locked locked) {
        Validate.notEmpty(locked.lockName());
        try {
            distributedLocker.lock(locked.lockName(), locked.leaseTime(), locked.waitTime(), 
            () -> {return proceed(pjp);});
        } catch (UnableToAquireLockException e) {
            if(!(locked.ignoreUnableToAquireLockException() || locked.ignoreException())) {
                LemonException.throwLemonException(e);
            }
            
        } catch (LemonException e) {
            if(! locked.ignoreException()) {
                throw e;
            }
           
        } catch (Throwable e) {
            if(! locked.ignoreException()) {
                LemonException.throwLemonException(e);
            }
           
        }
    }

```


---------------------------------------

##  æ—¥ç´¯è®¡ã€æœˆç´¯è®¡

+   åˆ©ç”¨rediså®ç°
+   æ¥å£Cumulative å®ç°äº†æ—¥ç´¯è®¡ã€æœˆç´¯è®¡ã€ æ—¥æœˆç´¯è®¡ã€æ—¥ç´¯è®¡æŸ¥è¯¢ã€æœˆç´¯è®¡æŸ¥è¯¢
+   æ”¯æŒå¤šç»´åº¦çš„ç´¯è®¡; new Dimension("K1","1") å¯¹è±¡ï¼ŒK1 è¡¨ç¤ºç»´åº¦ã€â€œ1â€ è¡¨ç¤ºç´¯è®¡å€¼ï¼Œå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªç»´åº¦
+   æ—¥ç´¯è®¡ã€æœˆç´¯è®¡ã€ æ—¥æœˆç´¯è®¡ ä½¿ç”¨LUA è„šæœ¬å®ç°ï¼ŒåŸå­æ€§æ“ä½œ
+   ä½¿ç”¨æ–¹æ³•è§ä¸‹é¢ä¾‹å­

```java
   
    @Autowired
    private Cumulative cumulative;

    @GetMapping("/testCumulative/{mode}")
    public GenericDTO<NoBody> testCumulative(@PathVariable String mode) {
        if(JudgeUtils.equals(mode, "0")) {
            this.cumulative.countByDay("TEST", new Dimension("K1","1"),new Dimension("K2","2"),new Dimension("K3","3"));
        } else if (JudgeUtils.equals(mode, "1")) {
            this.cumulative.countByMonth("TEST", new Dimension("K1","1"),new Dimension("K2","2"),new Dimension("K3","3"));
        } else if(JudgeUtils.equals(mode, "2")) {
            this.cumulative.countByDayAndMonth("TEST", new Dimension("K1","1"),new Dimension("K2","2"),new Dimension("K3","3"));
        }
        return GenericDTO.newSuccessInstance();
    }
    
    @GetMapping("/queryCumulative/{mode}/{dimension}")
    public GenericDTO<String> testCumulative(@PathVariable String mode, @PathVariable String dimension) {
        String rst = "";
        if(JudgeUtils.equals(mode, "0")) {
           rst = this.cumulative.queryByDay("TEST", dimension);
        } else if (JudgeUtils.equals(mode, "1")) {
           rst = this.cumulative.queryByMonth("TEST", dimension);
        }
        return GenericDTO.newSuccessInstance(rst);
    }

```

---------------------------------------

## Bean validation JSR303 JSR349

+   feign client bean validate, æ³¨è§£ @com.hisun.lemon.framework.validation.ClientValidated

```java
//åœ¨å®¢æˆ·ç«¯è¿›è¡Œè¾“å…¥å‚æ•°çš„æ ¡éªŒï¼Œåªéœ€è¦åœ¨è¾“å…¥DTOæ³¨è§£ @com.hisun.lemon.framework.validation.ClientValidated

@ClientValidated
public class UserQueryDTO{
    @NotEmpty(message="DM310001")
    private String name;
    
    private Integer pageNum;
    
```
```yaml
åŒæ—¶é…ç½®æ–‡ä»¶éœ€è¦å¼€å¯å®¢æˆ·ç«¯éªŒè¯ï¼š
feign :
  validation :
    enabled : true

```

+   æœåŠ¡ç«¯ mvc æ–¹æ³•çº§åˆ« bean validate, æ³¨è§£@Validated

```java
    //åœ¨controllerå±‚çš„æ–¹æ³•è¾“å…¥å‚æ•°æ³¨è§£ @Validated
    @PostMapping("/addUser")
    public GenericDTO<NoBody> addUser(@Validated @RequestBody UserDTO userDTO) {
        UserDO userDO = new UserDO();
        BeanUtils.copyProperties(userDO, userDTO);
        this.userService.addUser(userDO);
        return GenericDTO.newSuccessInstance();
    }

```

---------------------------------------

##  è½®è¯¢ã€å®šæ—¶ä»»åŠ¡

+   org.springframework.scheduling.annotation.Scheduled

+   ä¾‹å¦‚ï¼š

```java

    @Scheduled(fixedRateString = "${feign.httpclient.clearConnectionsRate}", initialDelay = 30000)
    public void clearExpiredAndIdleConnections() {
        if(JudgeUtils.isNotNull(poolingHttpClientConnectionManager)) {
            poolingHttpClientConnectionManager.closeExpiredConnections();
            poolingHttpClientConnectionManager.closeIdleConnections(feignHttpclientProperties.getIdleTimeoutMillis(), TimeUnit.MILLISECONDS);
        }
    }
    
      
```

+   çº¿ç¨‹æ± é…ç½®

```yaml

  schedule :
    threadPool :
      poolSize : 10
      waitForTasksToCompleteOnShutdown : true
      awaitTerminaltionSeconds : 30
      
```

+   æ–¹æ³•è°ƒç”¨å‰ä¼šè‡ªåŠ¨åˆå§‹åŒ–LemonDataï¼Œå¯ä»¥ä»LemonUtilsè·å–

---------------------------------------

##  æ‰¹å¤„ç†

+   com.hisun.lemon.framework.schedule.batch.BatchScheduledï¼Œ æ³¨è§£å‚æ•°åŒ@Scheduled

+   ç¤ºä¾‹

```java

    @BatchScheduled(fixedRate=10000)
    public void schedule() {
        System.out.println("@BatchScheduled test..................");
    }
    
```
+   çº¿ç¨‹æ± é…ç½®åŒ â€œè½®è¯¢ã€å®šæ—¶ä»»åŠ¡â€

+   æ‰¹å¤„ç†æ¨¡å¼ä¸‹ï¼Œ@Schedule ä¸ä¼šå¤„ç†

+   æ‰¹å¤„ç†æ¨¡å¼ä¸‹ï¼ŒMQæ¶ˆè´¹è€…ä¸ä¼šå¯åŠ¨

+   å¼€å¯æ‰¹å¤„ç†æ¨¡å¼,é»˜è®¤æœªå¼€å¯

>
>   æ–¹å¼ä¸€ï¼š
>
>   javaå‚æ•°å½¢å¼"-Dlemon.batch.enabled=true"
>
>   æ–¹å¼äºŒï¼š
>   
>   ymlé…ç½® "lemon.batch.enabled=true"
>

+   æ–¹æ³•è°ƒç”¨å‰ä¼šè‡ªåŠ¨åˆå§‹åŒ–LemonDataï¼Œå¯ä»¥ä»LemonUtilsè·å–

---------------------------------------

##  å›½é™…åŒ–

+   æ¶ˆæ¯ç å·²æä¾›æ”¯æŒï¼Œæ¶ˆæ¯ç è¡¨ï¼šlemon.lemon_msg_info
+   com.hisun.lemon.framework.i18n.LocaleMessageSourceï¼Œè¯¥ç±»åœ¨BaseController å·²æ³¨å…¥ï¼Œè¯»å–é…ç½®æ–‡ä»¶**i18n/message.properties**
+   ç³»ç»Ÿå–ä¸åˆ°åŒºåŸŸä¿¡æ¯ã€æˆ–åŒºåŸŸä¿¡æ¯ä¸åœ¨å¹³å°è¯†åˆ«çš„èŒƒå›´ç±»æ˜¯ï¼Œé»˜è®¤çš„åŒºåŸŸé…ç½®

```yaml
lemon:
  locale :
    default : zh_cn
```

---------------------------------------

##  å¼‚æ­¥åŠè®¢é˜…å‘å¸ƒ

+   spring cloud stream rabbit å®ç°

+   é…ç½®æ–‡ä»¶

```yaml

spring :
  rabbitmq :
    addresses : 192.168.1.38:5672
    virtualHost : /lemon
    username : rabbitmq
    password : Rabbitmq123
    requestedHeartbeat : 10
    publisherConfirms : true
    publisherReturns : true
    connectionTimeout : 10000
    cache:
      channel :
        size : 5
    listener :
      concurrency : 1
      maxConcurrency : 5
      idleEventInterval : 60000
      prefetch : 10
      transactionSize : 10
  cloud :
    stream :
      defaultBinder : rabbit
      bindings :
        # è¾“å…¥é€šé“ï¼Œå³æ¶ˆè´¹è€…æ¶ˆè´¹çš„é€šé“
        input :
          destination : ${spring.application.name}
          group : ${spring.application.name}
          consumer :
            #   æ˜¯å¦å¯åŠ¨æ¶ˆè´¹è€…
            enable : false
            concurrency : 1
            maxConcurrency : 5
            maxAttempts : 1
            durableSubscription : true
            prefetch : 10
            txSize : 10
          producer :
            deliveryMode : PERSISTENT
        # è¾“å‡ºé€šé“
        output :
          #æ˜¯å¦å¯åŠ¨è¯¥é€šé“
          enable : true
          #é€šé“ç»‘å®šçš„topicï¼Œ rabbitmq å¯¹åº” exchangeï¼› kafkaå¯¹åº”ä¸»é¢˜ï¼›æˆ‘ä»¬åœ¨æ­¤å¤„é…ç½®å®ä¾‹åï¼Œå³å°†æ¶ˆæ¯å‘é€åˆ°å“ªä¸ªå®ä¾‹ï¼ˆè®¢é˜…è€…ï¼‰
          destination : USR
        output1 :
          enable : true
          destination : output1-test

```

+   ç”Ÿäº§è€…ï¼ˆè®¢é˜…å‘å¸ƒçš„å‘å¸ƒè€…ï¼‰

```java
//æ¡†æ¶ä¼šè‡ªåŠ¨å°†æ–¹æ³•çš„è¿”å›å¯¹è±¡ï¼ˆå³ä¸»é¢˜ã€Helloå¯¹è±¡ï¼‰é€šè¿‡é€šé“ï¼ˆchannelNameï¼‰å‘é€å‡ºå»
@Component
public class TestProducer {
    @Producers({
        @Producer(beanName="helloMessageHandler", channelName=MultiOutput.OUTPUT_DEFAULT),          //beanName ä¸ºæ¶ˆè´¹ä¸»é¢˜(Hello)çš„spring bean name
        @Producer(beanName="helloMessageHandler2", channelName=MultiOutput.OUTPUT_DEFAULT)          //channelName ä¸ºå°†ä¸»é¢˜å‘é€å‡ºå»çš„é€šé“åï¼Œå¦‚é…ç½®æ–‡ä»¶ä¸­çš„output
    })
    public Hello sendHello() {
        return new Hello("hello-->",40);
    }
}

//ç³»ç»Ÿé»˜è®¤å¯ä»¥å¯åŠ¨8ä¸ªé€šé“
    public static final String OUTPUT_DEFAULT = "output";
    public static final String OUTPUT_ONE = "output1";
    public static final String OUTPUT_TWO = "output2";
    public static final String OUTPUT_THREE = "output3";
    public static final String OUTPUT_FOUR = "output4";
    public static final String OUTPUT_FIVE = "output5";
    public static final String OUTPUT_SIX = "output6";
    public static final String OUTPUT_SEVEN = "output7";

```

+   æ¶ˆè´¹è€…(è®¢é˜…å‘å¸ƒä¸­çš„è®¢é˜…è€…)ï¼Œæ¡†æ¶é»˜è®¤é…ç½®ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹inputé€šé“

+   æ¶ˆè´¹è€…ä¸­çš„pring bean å¿…é¡»å®ç° com.hisun.lemon.framework.stream.MessageHandler æ¥å£

```java

@Component("helloMessageHandler")
public class HelloMessageHandler implements MessageHandler<Hello> {
    private static final Logger logger = LoggerFactory.getLogger(HelloMessageHandler.class);
    
    @Override
    public void onMessageReceive(GenericCmdDTO<Hello> genericCmdDTO) {
        logger.info("Receive msg hand {}", genericCmdDTO.getBody());
    }
}

```

---------------------------------------

##  éšæœºæ•°

+   ç¤ºä¾‹

```java

    @Resource("bindingTokenRandomTemplete")
    private RandomTemplete randomTemplete;
    
    @GetMapping("/testRandomTemplete")
    public GenericRspDTO<NoBody> testRandomTemplete() {
        String random = randomTemplete.apply("Test", 30*60*1000, RandomType.NUMERIC_LETTER, 15);
        logger.info("random is {}", random);
        randomTemplete.validateOnce("Test", random);
        return GenericRspDTO.newSuccessInstance();
    }

```

+   å…·ä½“è§æ¥å£ [com.hisun.lemon.framework.utils.RandomTemplete]()

+   å®ç°ç±»com.hisun.lemon.framework.redis.random.BindingTokenRandomTemplete; ä¸ç”¨æˆ·sessionIdç»‘å®š


---------------------------------------

##  ç¼–è¯‘ã€æ‰“åŒ…ã€å¯åŠ¨æœåŠ¡

+   è¿è¡Œgradle å‘½ä»¤ï¼š gradle clean build dist
+   åœ¨å·¥ç¨‹ç›®å½•ä¸‹çš„build/targetçš„ç›®å½•ä¸‹ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶åŠæ–‡ä»¶å¤¹

>   bin
>
>   lemon-prd-1.0.0-SNAPSHOT.jar
>
>   config
>
>   è¿è¡Œbin/start.sh å³å¯ä»¥å¯åŠ¨æœåŠ¡

+   åœ¨å·¥ç¨‹ç›®å½•ä¸‹çš„build/distributionsç›®å½•ä¸‹ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶

>
>   lemon-prd-1.0.0-SNAPSHOT.zip
>
>   æŠŠæ­¤zipæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨è§£å‹å¯ä»¥å¾—åˆ°build/targetçš„ç›®å½•ç»“æ„

---------------------------------------

##  é€šé“

+   é¡¹ç›®å¼•å…¥é€šé“æ¡†æ¶

```gradle

    compile("com.hisun:channel-integration-starter:1.0.0-SNAPSHOT")

```

+   å¼•å…¥è‡ªå·±å¼€å‘çš„é€šé“é¡¹ç›®ï¼Œå‚è€ƒ:channel:channel-cmsb

```gradle

    compile("com.hisun:channel-cmsb:1.0.0-SNAPSHOT")
    compile("com.hisun:channel-cgb:1.0.0-SNAPSHOT")

```

+   é€šé“å¼€å‘è¯¦æƒ…è§ [ã€Šé€šé“å¼€å‘æŒ‡å—.docxã€‹](http://120.76.22.56/microservices-platform/channel/blob/master/%E9%80%9A%E9%81%93%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.docx)
    
>
>   ä¿®æ”¹ï¼š
>    1ï¼Œ å„å­é€šé“é…ç½®æ–‡ä»¶ä¸éœ€è¦åœ¨config/channel-spring.xmlæ–‡ä»¶ä¸­import, é…ç½®æ–‡ä»¶å‘½åè§„åˆ™æ”¹ä¸ºâ€œé¡¹ç›®å-channel-spring.xmlâ€
>    

+   å®¢æˆ·ç«¯ä»£ç 

```java

    
    @Autowired
    private IChannelClient channelClient;
    
    @GetMapping("/testChannel")
    public GenericRspDTO<?> testChannel(GenericDTO<NoBody> genericDTO) {
        LocalDateTime localDate = LocalDateTime.now();
        DateTimeFormatter formatterDate = DateTimeFormatter.ofPattern("yyyyMMdd");
        DateTimeFormatter formatterTime = DateTimeFormatter.ofPattern("HHmmss");
        PayReq.TranReq tranReq = new PayReq.TranReq();
        tranReq.setMchntCd("MCH0000000000001");
        tranReq.setTranDate(localDate.format(formatterDate));
        tranReq.setTranTime(localDate.format(formatterTime));
        tranReq.setTranId("1602061010000000");
        tranReq.setCurrency("RMB");
        tranReq.setPayAcctNo("PAYACCNO0000002");
        tranReq.setPayAccName("yuzhou");
        tranReq.setPayBankType("1");
        tranReq.setPayBankName("ä¸­å›½é“¶è¡Œ");
        tranReq.setAccNo("6226192914678983");
        tranReq.setAccName("YUZHOU");
        tranReq.setBankType("105100000017");
        tranReq.setBankName("æ‹›è¡Œ");
        tranReq.setTransAmt(new BigDecimal("99.99"));
        tranReq.setRemarkCd("90804");
        tranReq.setRemark("case115");
        tranReq.setResv("case115");
        
        PayReq payReq = new PayReq();
        payReq.setCooperationCd("1000000000001");
        payReq.setTxCd("3002");
        payReq.setTranReq(tranReq);
        
        Request request = new Request();
        request.setRoute("CMSB");
        request.setBusiType("pay");
        request.setSource("tst");
        request.setTarget(payReq);
        request.setRequestId(genericDTO.getMsgId());
        Response response = channelClient.request(request);
        logger.info("channel rsp code {}", response.getMsgCode());
        logger.info("channel rsp info {}", response.getMsgInfo());
        logger.info("channel rsp object {}", response.getResult());
        return GenericRspDTO.newInstance(response.getMsgCode(), response.getResult());
    }

```

---------------------------------------

##  è¸©è¿‡çš„å‘
+   ribbon é»˜è®¤ä¼šå¯¹è¶…æ—¶çš„GETè¯·æ±‚retryä¸€æ¬¡ã€‚åŠ ä¸Šä»¥ä¸‹é…ç½®ï¼Œè¦†ç›–ribboné»˜è®¤é…ç½®

```yaml

ribbon :
  #retry next Server times
  MaxAutoRetriesNextServer : 0
  #retry same Server times
  MaxAutoRetries : 0
  ReadTimeout : 20000
  ConnectTimeout : 5000

```

+   åœ¨Feign client ä¸­ä½¿ç”¨@PathVariable æ³¨è§£ï¼Œå¿…é¡»æŒ‡å®švalueå€¼,  ```å¦åˆ™ä¼šæŠ¥ï¼šjava.lang.IllegalStateException: PathVariable annotation was empty on param 0. ```

```java

@GetMapping(value = "/user/{id}")  
User findById(@PathVariable("id") Long id);  

```

+   å…³äºGETè¯·æ±‚å‚æ•°ç»‘å®šä¸æ”¯æŒGenericDTO<T>

>
>   **åŸå› ï¼š**
>
>   1, spring mvc çš„URLå‚æ•°ç»‘å®šä¸æ”¯æŒæ³›å‹
>
>   2, feign å¯¹è±¡GETè¯·æ±‚ä¹Ÿæ˜¯ç”¨Body(Json)å‘é€
>

è§£å†³æ–¹æ³•ä¸€ï¼šå‚æ•°ç»§æ‰¿```GenericDTO<NoBody>``` ï¼Œ GenericDTOæˆ–å…¶å­ç±» å¿…é¡» @LemonBodyæ³¨è§£
```java
        @GetMapping("/findUser2")
    public GenericRspDTO<List<User>> findUser2(@Validated @LemonBody UserQueryDTO queryUserDTO) {
        List<User> users = null;
        //çœç•¥
        return GenericRspDTO.newSuccessInstance(users);
    }
    
    @ClientValidated
    @ApiModel(value="UserQueryDTO", description="ç”¨æˆ·æŸ¥è¯¢ä¼ è¾“å¯¹è±¡")
    public class UserQueryDTO extends GenericDTO<NoBody>{
        @ApiModelProperty(value="å§“å", required= true)
        @NotEmpty(message="DM310001")
        private String name;
    }
```

è§£å†³æ–¹æ³•äºŒ: å¤šä¸ªå‚æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸º```GenericDTO<NoBody>``` ;GenericDTO å¿…é¡» @LemonBodyæ³¨è§£ å½“å‚æ•°æ¯”è¾ƒå›ºå®šçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆ
```java
    @GetMapping("/findUser3")
    public GenericRspDTO<List<User>> findUser3(@RequestParam String name, @RequestParam int pageNum, 
        @RequestParam int pageSize, @LemonBody GenericDTO<NoBody> genericDTO) {
        List<User> users = null;
        //çœç•¥
        return GenericRspDTO.newSuccessInstance(users);
    }
```

feign æ¥å£ä¹Ÿéœ€è¦@LemonBodyæ³¨è§£

```java

    @GetMapping("/user/findUser2")
    public GenericRspDTO<List<UserQueryDTO.User>> findUser2(@LemonBody UserQueryDTO userQueryDTO);
    

    @GetMapping("/user/findUser3")
    public GenericRspDTO<List<UserQueryDTO.User>> findUser3(@RequestParam("name") String name, @RequestParam("pageSize") Integer pageSize, @RequestParam("pageNum") Integer pageNum, @Validated @LemonBody GenericDTO<NoBody> genericDTO);
    

```

GenericDTO å­ç±»ä¸­å±æ€§å¿½ç•¥ä½œä¸ºparameteré€šè¿‡feignæ¥å£å‘é€ï¼Œéœ€è¦ç”¨@IgnoreLemonBody æ³¨è§£

```java

    @ApiModelProperty(value="ç”¨æˆ·åˆ—è¡¨" )
    @IgnoreLemonBody
    private List<User> users;

```

---------------------------------------

##  mybatis ä»£ç è‡ªåŠ¨ç”Ÿæˆ

+   mybatis ä»£ç è‡ªåŠ¨ç”Ÿæˆæ˜¯æ ¹æ®mybatis-generatorä¿®æ”¹è€Œæˆï¼Œè§é¡¹ç›® [lemon-generator](http://120.76.22.56/microservices-platform/framework/tree/master/lemon-generator)

+   ä¿®æ”¹é…ç½®æ–‡ä»¶    [generatorConfig.xml](http://120.76.22.56/microservices-platform/framework/blob/master/lemon-generator/generatorConfig.xml)

>
+   ä¿®æ”¹æ•°æ®åº“å‚æ•°  **connectionURL** 
```xml
<jdbcConnection driverClass="com.mysql.jdbc.Driver" connectionURL="jdbc:mysql://localhost:3306/seatelpay" userId="seatelpay" password="seatelpay">  
</jdbcConnection>
```
> 
+   ä¿®æ”¹ç”Ÿæˆæ–‡ä»¶å­˜æ”¾ç›®å½•    **targetProject**   åŠå·¥ç¨‹ç›®å½•ç»“æ„  **targetPackage**  ï¼Œå…¶ä»–é…ç½®éƒ½ä¸è¦ä¿®æ”¹
```xml
<javaModelGenerator targetPackage="com.hisun.lemon.prd.entity" targetProject="/Users/yuzhou/Documents/work/temp/java">
<sqlMapGenerator targetPackage="com.hisun.lemon.prd.mapper" targetProject="/Users/yuzhou/Documents/work/temp/resources"> 
<javaClientGenerator type="XMLMAPPER" targetPackage="com.hisun.lemon.prd.dao" targetProject="/Users/yuzhou/Documents/work/temp/java">
```
>

+   è¿è¡Œ org.mybatis.generator.api.ShellRunner


+   ç”Ÿæˆä»£ç æ•ˆæœå¦‚ä¸‹ï¼š

>   java dao interface  ,æ‰©å±•çš„æ–¹æ³•åœ¨æ­¤æ¥å£ä¸­å®šä¹‰

```java
    package com.hisun.lemon.prd.dao;

    import com.hisun.lemon.framework.dao.BaseDao;
    import com.hisun.lemon.prd.entity.UserDO;
    import org.apache.ibatis.annotations.Mapper;

    @Mapper
    public interface UserDao extends BaseDao<UserDO> {
    }
```
>

>   java entity

```java
package com.hisun.lemon.prd.entity;

import com.hisun.lemon.framework.data.BaseDO;
import java.time.LocalDate;

public class UserDO extends BaseDO {
    /**
     * @Fields userId 
     */
    private String userId;
    //.....çœç•¥
}

```
>

>  xml mapper   **xmlæ²¡æœ‰è‡ªåŠ¨ç”ŸæˆBaseDAOçš„find æ¥å£çš„ä»£ç ï¼Œè¯·è‡ªè¡Œå®ç°** å¯ä»¥å‚è€ƒ[UserMapper.xml](http://120.76.22.56/microservices-platform/microservices-demo/blob/master/lemon-prd/src/main/resources/com/hisun/lemon/prd/mapper/UserMapper.xml)

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hisun.lemon.prd.dao.UserDao" >

    <resultMap id="BaseResultMap" type="com.hisun.lemon.prd.entity.UserDO" >
        <id column="user_id" property="userId" jdbcType="VARCHAR" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="age" property="age" jdbcType="INTEGER" />
        <result column="birthday" property="birthday" jdbcType="DATE" />
        <result column="sex" property="sex" jdbcType="CHAR" />
        <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    </resultMap>

    <sql id="Base_Column_List" >
        user_id, name, age, birthday, sex, modify_time, create_time
    </sql>
```


